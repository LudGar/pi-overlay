<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pi Digit Tiles Preview</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      background: #808080; color: #fff;
      font-family: monospace;
      height: 100vh; overflow: hidden;
    }

    .layout { display: flex; flex-direction: column; height: 100vh; }

    .main { flex: 1 1 auto; overflow: hidden; position: relative; }
    .tiles-wrapper {
      display: flex; flex-direction: row; white-space: nowrap;
      align-items: flex-start; height: 100%;
    }

    .tile { text-align: right; color: white; }
    .tile div {
      font-size: 10px;
      background: rgba(0, 0, 0, 0.5);
      padding: 2px 4px;
    }
    .tile img {
      display: block;
      width: auto;
      height: 100%;
      image-rendering: pixelated;
      margin: 0; padding: 0;
    }

    .scrollbar {
      height: 14px;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .scrollbar-inner { height: 1px; }

    .zoom-controls {
      position: absolute; top: 8px; left: 8px; z-index: 10;
      background: rgba(0, 0, 0, 0.4); padding: 6px 10px; border-radius: 4px;
    }
    .zoom-controls button {
      font-size: 14px; margin: 0 4px; background: #222; color: #fff;
      border: none; padding: 4px 8px; cursor: pointer;
    }
    .zoom-level { font-size: 12px; margin-left: 8px; }

    ::-webkit-scrollbar { height: 12px; }
    ::-webkit-scrollbar-track { background: #808080; }
    ::-webkit-scrollbar-thumb { background-color: #333; border-radius: 4px; }

    * {
      scrollbar-width: thin;
      scrollbar-color: #333 #808080;
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="main" id="main">
      <div class="zoom-controls">
        <button id="zoomOut">–</button>
        <button id="zoomIn">+</button>
        <span class="zoom-level" id="zoomLevel">x1</span>
      </div>
      <div class="tiles-wrapper" id="tiles">
        <!-- JS will inject tiles here -->
      </div>
    </div>
    <div class="scrollbar" id="scrollbar">
      <div class="scrollbar-inner" id="scrollbarInner"></div>
    </div>
  </div>

  <script>
    const tilesEl = document.getElementById("tiles");
    const scrollbar = document.getElementById("scrollbar");
    const scrollbarInner = document.getElementById("scrollbarInner");
    const main = document.getElementById("main");
    const zoomLevelText = document.getElementById("zoomLevel");

    let zoom = 1;

    function applyZoom() {
      const baseH = main.clientHeight;
      tilesEl.querySelectorAll("img").forEach(img => {
        img.style.height = (baseH * zoom) + "px";
      });
      requestAnimationFrame(() => {
        scrollbarInner.style.width = tilesEl.scrollWidth + "px";
      });
      zoomLevelText.textContent = `x${zoom}`;
    }

    function changeZoom(dir) {
      const prevZoom = zoom;
      zoom = Math.max(1, zoom + dir);
      if (zoom === prevZoom) return;

      const maxScroll = Math.max(1, tilesEl.scrollWidth - main.clientWidth);
      const ratio = main.scrollLeft / maxScroll;

      applyZoom();

      requestAnimationFrame(() => {
        const newMax = Math.max(1, tilesEl.scrollWidth - main.clientWidth);
        main.scrollLeft = ratio * newMax;
        scrollbar.scrollLeft = main.scrollLeft;
      });
    }

    document.getElementById("zoomIn").addEventListener("click", () => changeZoom(1));
    document.getElementById("zoomOut").addEventListener("click", () => changeZoom(-1));
    scrollbar.addEventListener("scroll", () => main.scrollLeft = scrollbar.scrollLeft);
    main.addEventListener("scroll", () => scrollbar.scrollLeft = main.scrollLeft);

    // Load tiles.json
    fetch("./tiles/tiles.json")
      .then(res => res.json())
      .then(tiles => {
        tiles.forEach((filename, index) => {
          const step = (index + 1) * 100;
          const tile = document.createElement("div");
          tile.className = "tile";

          const title = document.createElement("div");
          title.textContent = step;

          const img = document.createElement("img");
          img.src = `./tiles/${filename}`;

          tile.appendChild(title);
          tile.appendChild(img);
          tilesEl.appendChild(tile);
        });

        // Once loaded, zoom
        const imgs = tilesEl.querySelectorAll("img");
        let loaded = 0;
        imgs.forEach(img => {
          if (img.complete) {
            loaded++;
            if (loaded === imgs.length) applyZoom();
          } else {
            img.addEventListener("load", () => {
              loaded++;
              if (loaded === imgs.length) applyZoom();
            });
          }
        });
        if (imgs.length === 0) applyZoom();
      })
      .catch(err => {
        console.error("tiles.json load failed:", err);
        tilesEl.innerHTML = `<div style="padding:1rem;">⚠️ Could not load tiles.json</div>`;
      });
  </script>
</body>
</html>
